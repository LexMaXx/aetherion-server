# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API –≤—ã–±–æ—Ä–∞/—Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤—ã–±—Ä–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞:
```
HTTP/1.1 400 Bad Request
{"success":false,"message":"characterId –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω"}
```

## –ü—Ä–∏—á–∏–Ω–∞

–ö–ª–∏–µ–Ω—Ç (Unity) –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª endpoint `/api/character/select`:
- –û—Ç–ø—Ä–∞–≤–ª—è–ª `{"characterClass":"Mage"}`
- –ê —Å–µ—Ä–≤–µ—Ä –æ–∂–∏–¥–∞–ª `{"characterId":"<id>"}`

## –°–µ—Ä–≤–µ—Ä–Ω—ã–µ Endpoints

### 1. **POST /api/character** - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
```json
// Request
{
  "name": "Warrior",
  "class": "Warrior"
}

// Response (201)
{
  "success": true,
  "message": "–ü–µ—Ä—Å–æ–Ω–∞–∂ —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ",
  "character": { ... }
}
```

### 2. **POST /api/character/select** - –í—ã–±–æ—Ä —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
```json
// Request
{
  "characterId": "507f1f77bcf86cd799439011"
}

// Response (200)
{
  "success": true,
  "message": "–ü–µ—Ä—Å–æ–Ω–∞–∂ –≤—ã–±—Ä–∞–Ω",
  "character": { ... }
}
```

### 3. **GET /api/character** - –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
```json
// Response (200)
{
  "success": true,
  "characters": [
    { "id": "...", "characterClass": "Warrior", ... },
    { "id": "...", "characterClass": "Mage", ... }
  ]
}
```

## –†–µ—à–µ–Ω–∏–µ

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ [CharacterData.cs](Assets/Scripts/Data/CharacterData.cs):

#### –î–æ–±–∞–≤–ª–µ–Ω `CreateCharacterRequest`:
```csharp
[Serializable]
public class CreateCharacterRequest
{
    public string name;
    private string @class; // –ò—Å–ø–æ–ª—å–∑—É–µ–º @ –¥–ª—è –æ–±—Ö–æ–¥–∞ –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–ª–æ–≤–∞

    public string characterClass
    {
        get { return @class; }
        set { @class = value; }
    }
}
```

#### –ò–∑–º–µ–Ω–µ–Ω `SelectCharacterRequest`:
```csharp
// –ë–´–õ–û:
public class SelectCharacterRequest
{
    public string characterClass; // ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
}

// –°–¢–ê–õ–û:
public class SelectCharacterRequest
{
    public string characterId; // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
}
```

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ [ApiClient.cs](Assets/Scripts/Network/ApiClient.cs):

#### –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:

1. **CreateCharacter** - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
```csharp
public void CreateCharacter(string token, CharacterClass characterClass,
    Action<CharacterResponse> onSuccess, Action<string> onError)
{
    string className = characterClass.ToString();
    string json = $"{{\"name\":\"{className}\",\"class\":\"{className}\"}}";
    // –§–æ—Ä–º–∏—Ä—É–µ–º JSON –≤—Ä—É—á–Ω—É—é –∏–∑-–∑–∞ –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–ª–æ–≤–∞ "class"

    StartCoroutine(PostRequestWithToken(CREATE_CHARACTER_ENDPOINT, token, json, onSuccess, onError));
}
```

2. **SelectCharacter** - –≤—ã–±–æ—Ä —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
```csharp
public void SelectCharacter(string token, string characterId,
    Action<CharacterResponse> onSuccess, Action<string> onError)
{
    SelectCharacterRequest request = new SelectCharacterRequest
    {
        characterId = characterId
    };

    string json = JsonUtility.ToJson(request);
    StartCoroutine(PostRequestWithToken(SELECT_CHARACTER_ENDPOINT, token, json, onSuccess, onError));
}
```

3. **SelectOrCreateCharacter** - —É–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω)
```csharp
public void SelectOrCreateCharacter(string token, CharacterClass characterClass,
    Action<CharacterResponse> onSuccess, Action<string> onError)
{
    // –®–∞–≥ 1: –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
    GetCharacters(token,
        onGetSuccess: (response) =>
        {
            // –®–∞–≥ 2: –ò—â–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –Ω—É–∂–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞
            CharacterInfo existingChar = null;
            foreach (var character in response.characters)
            {
                if (character.characterClass == characterClass.ToString())
                {
                    existingChar = character;
                    break;
                }
            }

            if (existingChar != null)
            {
                // –ü–µ—Ä—Å–æ–Ω–∞–∂ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –≤—ã–±–∏—Ä–∞–µ–º –µ–≥–æ
                SelectCharacter(token, existingChar.id, onSuccess, onError);
            }
            else
            {
                // –ü–µ—Ä—Å–æ–Ω–∞–∂–∞ –Ω–µ—Ç - —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ
                CreateCharacter(token, characterClass, onSuccess, onError);
            }
        },
        onGetError: (error) =>
        {
            onError?.Invoke(error);
        }
    );
}
```

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ (–Ω–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π)
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∫–ª–∞—Å—Å Warrior –∏ –Ω–∞–∂–∏–º–∞–µ—Ç "–í –±–æ–π"
2. `SelectOrCreateCharacter(token, Warrior, ...)`
3. –ó–∞–ø—Ä–æ—Å GET /api/character ‚Üí `{"success":true,"characters":[]}`
4. –°–ø–∏—Å–æ–∫ –ø—É—Å—Ç ‚Üí –≤—ã–∑–æ–≤ `CreateCharacter(token, Warrior, ...)`
5. –ó–∞–ø—Ä–æ—Å POST /api/character ‚Üí `{"name":"Warrior","class":"Warrior"}`
6. –û—Ç–≤–µ—Ç: `{"success":true,"character":{...}}`
7. –ü–µ—Ä—Å–æ–Ω–∞–∂ —Å–æ–∑–¥–∞–Ω –∏ –≤—ã–±—Ä–∞–Ω ‚úÖ

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ (–ø–µ—Ä—Å–æ–Ω–∞–∂ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∫–ª–∞—Å—Å Warrior –∏ –Ω–∞–∂–∏–º–∞–µ—Ç "–í –±–æ–π"
2. `SelectOrCreateCharacter(token, Warrior, ...)`
3. –ó–∞–ø—Ä–æ—Å GET /api/character ‚Üí `{"success":true,"characters":[{"id":"123","characterClass":"Warrior",...}]}`
4. –ù–∞–π–¥–µ–Ω Warrior —Å id=123 ‚Üí –≤—ã–∑–æ–≤ `SelectCharacter(token, "123", ...)`
5. –ó–∞–ø—Ä–æ—Å POST /api/character/select ‚Üí `{"characterId":"123"}`
6. –û—Ç–≤–µ—Ç: `{"success":true,"character":{...}}`
7. –ü–µ—Ä—Å–æ–Ω–∞–∂ –≤—ã–±—Ä–∞–Ω ‚úÖ

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–ª Warrior, —Ç–µ–ø–µ—Ä—å –≤—ã–±–∏—Ä–∞–µ—Ç Mage
2. `SelectOrCreateCharacter(token, Mage, ...)`
3. –ó–∞–ø—Ä–æ—Å GET /api/character ‚Üí `{"success":true,"characters":[{"id":"123","characterClass":"Warrior"}]}`
4. Mage –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –≤—ã–∑–æ–≤ `CreateCharacter(token, Mage, ...)`
5. –ó–∞–ø—Ä–æ—Å POST /api/character ‚Üí `{"name":"Mage","class":"Mage"}`
6. –û—Ç–≤–µ—Ç: `{"success":true,"character":{...}}`
7. –ù–æ–≤—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂ Mage —Å–æ–∑–¥–∞–Ω ‚úÖ

## –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º

–í [CharacterSelectionManager.cs](Assets/Scripts/UI/CharacterSelectionManager.cs) –µ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º:

```csharp
// –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —Ç–µ—Å—Ç–æ–≤—ã–π - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É
if (token == "test_token_for_multiplayer")
{
    Debug.Log("[TEST MODE] üöÄ –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É");
    PlayerPrefs.SetString("SelectedCharacterId", "test_character_" + selectedClass.ToString());
    PlayerPrefs.SetString("SelectedCharacterClass", selectedClass.ToString());
    SceneManager.LoadScene(loadingSceneName);
    return;
}
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### Unity Console (–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞):
```
SelectOrCreateCharacter –¥–ª—è –∫–ª–∞—Å—Å–∞: Mage
–ó–∞–ø—Ä–æ—Å —Å–ø–∏—Å–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π: https://aetherion-server-gv5u.onrender.com/api/character
–°–ø–∏—Å–æ–∫ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –ø–æ–ª—É—á–µ–Ω: {"success":true,"characters":[...]}
–ü–µ—Ä—Å–æ–Ω–∞–∂ Mage –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ
–°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –∫–ª–∞—Å—Å–∞: Mage
JSON: {"name":"Mage","class":"Mage"}
–í—ã–±–æ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–∞: https://aetherion-server-gv5u.onrender.com/api/character
HTTP/1.1 201 Created
–ü–µ—Ä—Å–æ–Ω–∞–∂ –≤—ã–±—Ä–∞–Ω: Mage, Level 1
```

### Unity Console (–æ—à–∏–±–∫–∞ –¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è):
```
–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –¥–ª—è –∫–ª–∞—Å—Å–∞: Mage
–î–∞–Ω–Ω—ã–µ: {"characterClass":"Mage"}
–û—à–∏–±–∫–∞: HTTP/1.1 400 Bad Request
–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ: {"success":false,"message":"characterId –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω"}
```

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

1. ‚úÖ [Assets/Scripts/Data/CharacterData.cs](Assets/Scripts/Data/CharacterData.cs)
   - –î–æ–±–∞–≤–ª–µ–Ω `CreateCharacterRequest`
   - –ò–∑–º–µ–Ω–µ–Ω `SelectCharacterRequest`

2. ‚úÖ [Assets/Scripts/Network/ApiClient.cs](Assets/Scripts/Network/ApiClient.cs)
   - –î–æ–±–∞–≤–ª–µ–Ω `CREATE_CHARACTER_ENDPOINT`
   - –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `CreateCharacter()`
   - –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `SelectCharacter()`
   - –ü–µ—Ä–µ–ø–∏—Å–∞–Ω –º–µ—Ç–æ–¥ `SelectOrCreateCharacter()` —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π

3. ‚úÖ [Assets/Scripts/UI/CharacterSelectionManager.cs](Assets/Scripts/UI/CharacterSelectionManager.cs)
   - –î–æ–±–∞–≤–ª–µ–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (—É–∂–µ –±—ã–ª)

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ:
1. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—ã–±–æ—Ä–µ –∫–ª–∞—Å—Å–∞ - —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂
2. –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—ã–±–æ—Ä–µ —Ç–æ–≥–æ –∂–µ –∫–ª–∞—Å—Å–∞ - –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–µ—Ä—Å–æ–Ω–∞–∂
3. –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –¥–æ 5 –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π (–ª–∏–º–∏—Ç —Å–µ—Ä–≤–µ—Ä–∞)
4. –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞

**–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ:**
1. –£–¥–∞–ª–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω: `PlayerPrefs.DeleteAll()` –≤ Unity Console
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å/–≤–æ–π–¥–∏—Ç–µ –≤ –∏–≥—Ä—É
3. –í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å –∏ –Ω–∞–∂–º–∏—Ç–µ "–í –±–æ–π"
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–µ—Ä—Å–æ–Ω–∞–∂ —Å–æ–∑–¥–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
