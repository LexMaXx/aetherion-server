#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è animationTrigger –≤—Å–µ—Ö —Å–∫–∏–ª–ª–æ–≤ –Ω–∞ MageAttack
"""

import os
import re

# –ü—É—Ç—å –∫ –ø–∞–ø–∫–µ —Å–æ —Å–∫–∏–ª–ª–∞–º–∏
SKILLS_PATH = r"c:\Users\Asus\Aetherion\Assets\Resources\Skills"

# –°–ø–∏—Å–æ–∫ —Å–∫–∏–ª–ª–æ–≤ –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å (–í–°–ï —Å–∫–∏–ª–ª—ã —Å projectilePrefab)
SKILLS_TO_UPDATE = [
    "Mage_Fireball.asset",
    "Mage_IceNova.asset",  # –£–∂–µ –∏–∑–º–µ–Ω—ë–Ω
    "Mage_LightningStorm.asset",  # –£–∂–µ –∏–∑–º–µ–Ω—ë–Ω
    "Mage_Meteor.asset",
    "Paladin_HammerofJustice.asset",  # –£–∂–µ –∏–∑–º–µ–Ω—ë–Ω
]

def update_skill_animation(filepath):
    """–ò–∑–º–µ–Ω–∏—Ç—å animationTrigger –Ω–∞ MageAttack"""
    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —É —Å–∫–∏–ª–ª–∞ projectilePrefab (–Ω–µ –ø—É—Å—Ç–æ–π)
    if 'projectilePrefab: {fileID: 0}' in content:
        print(f"‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ {os.path.basename(filepath)} - –Ω–µ—Ç —Å–Ω–∞—Ä—è–¥–∞")
        return False

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–π animationTrigger
    current_trigger = re.search(r'animationTrigger:\s*(\w*)', content)
    if current_trigger:
        trigger_value = current_trigger.group(1)
        if trigger_value == "MageAttack":
            print(f"‚úÖ {os.path.basename(filepath)} - —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç MageAttack")
            return False

        # –ó–∞–º–µ–Ω—è–µ–º animationTrigger
        content = re.sub(
            r'animationTrigger:\s*\w*',
            'animationTrigger: MageAttack',
            content
        )

        # –ï—Å–ª–∏ –Ω–µ—Ç castTime, –¥–æ–±–∞–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.5
        if 'castTime: 0\n' in content or 'castTime: 0.0\n' in content:
            content = re.sub(
                r'castTime: 0(?:\.0)?\n',
                'castTime: 0.5\n',
                content
            )

        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(content)

        print(f"‚úèÔ∏è  {os.path.basename(filepath)} - –∏–∑–º–µ–Ω—ë–Ω –Ω–∞ MageAttack (–±—ã–ª–æ: {trigger_value})")
        return True

    return False

def main():
    print("üîß –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ animationTrigger –¥–ª—è —Å–∫–∏–ª–ª–æ–≤...")
    print(f"üìÇ –ü—É—Ç—å: {SKILLS_PATH}\n")

    updated_count = 0

    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ .asset —Ñ–∞–π–ª—ã
    for filename in os.listdir(SKILLS_PATH):
        if not filename.endswith('.asset'):
            continue

        filepath = os.path.join(SKILLS_PATH, filename)
        if update_skill_animation(filepath):
            updated_count += 1

    print(f"\n‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ —Å–∫–∏–ª–ª–æ–≤: {updated_count}")

if __name__ == "__main__":
    main()
