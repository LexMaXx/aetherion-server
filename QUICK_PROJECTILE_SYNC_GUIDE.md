# –ë–´–°–¢–†–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò –°–ù–ê–†–Ø–î–û–í

## ‚úÖ –°–æ–∑–¥–∞–Ω helper –∫–æ–º–ø–æ–Ω–µ–Ω—Ç: ProjectileSyncHelper.cs

–≠—Ç–æ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å–Ω–∞—Ä—è–¥—ã —Å —Å–µ—Ä–≤–µ—Ä–æ–º.

## üìù –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ü–†–ò–ú–ï–ù–ï–ù–ò–Æ

### –®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –≤ SkillExecutor.cs

**–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª:** `Assets/Scripts/Skills/SkillExecutor.cs`

**–ù–∞–π–¥–∏—Ç–µ –º–µ—Ç–æ–¥** `LaunchProjectile` (–æ–∫–æ–ª–æ —Å—Ç—Ä–æ–∫–∏ 263)

**–ü–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏:**
```csharp
GameObject projectile = Instantiate(skill.projectilePrefab, spawnPos, Quaternion.LookRotation(direction));
```

**–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥:**
```csharp
// üöÄ SYNC: Add sync helper to projectile
ProjectileSyncHelper syncHelper = projectile.AddComponent<ProjectileSyncHelper>();
string targetSocketId = "";
if (target != null)
{
    NetworkPlayer networkTarget = target.GetComponent<NetworkPlayer>();
    if (networkTarget != null)
    {
        targetSocketId = networkTarget.socketId;
    }
}
syncHelper.SyncToServer(skill.skillId, spawnPos, direction, targetSocketId);
```

### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ NetworkSyncManager.cs

**–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª:** `Assets/Scripts/Network/NetworkSyncManager.cs`

**–í –º–µ—Ç–æ–¥** `SubscribeToNetworkEvents()` –¥–æ–±–∞–≤—å—Ç–µ:
```csharp
socketIO.On("projectile_spawned", OnProjectileSpawned);
```

**–î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ –≤ –∫–ª–∞—Å—Å:**
```csharp
private void OnProjectileSpawned(string jsonData)
{
    try
    {
        var data = JsonConvert.DeserializeObject<ProjectileSpawnedEvent>(jsonData);

        Debug.Log($"[NetworkSync] üöÄ Received projectile from {data.casterSocketId}: skillId={data.skillId}");

        // Don't create projectile for ourselves (we already have it)
        if (data.casterSocketId == socketIO.GetSocketId())
        {
            return;
        }

        // Load skill config by ID
        SkillConfig[] allSkills = Resources.LoadAll<SkillConfig>("Skills");
        SkillConfig skill = null;
        foreach (SkillConfig s in allSkills)
        {
            if (s.skillId == data.skillId)
            {
                skill = s;
                break;
            }
        }

        if (skill == null || skill.projectilePrefab == null)
        {
            Debug.LogWarning($"[NetworkSync] Projectile prefab not found for skillId={data.skillId}");
            return;
        }

        // Create projectile visually
        Vector3 spawnPos = new Vector3(data.spawnPosition.x, data.spawnPosition.y, data.spawnPosition.z);
        Vector3 direction = new Vector3(data.direction.x, data.direction.y, data.direction.z);

        GameObject projectile = Instantiate(skill.projectilePrefab, spawnPos, Quaternion.LookRotation(direction));

        // Initialize for visual only (NO damage from network projectiles)
        Projectile proj = projectile.GetComponent<Projectile>();
        ArrowProjectile arrow = projectile.GetComponent<ArrowProjectile>();
        CelestialProjectile celestial = projectile.GetComponent<CelestialProjectile>();

        Transform targetTransform = null;
        if (!string.IsNullOrEmpty(data.targetSocketId))
        {
            if (networkPlayers.ContainsKey(data.targetSocketId))
            {
                targetTransform = networkPlayers[data.targetSocketId].transform;
            }
        }

        // Initialize with 0 damage (visual only)
        if (celestial != null)
        {
            celestial.Initialize(targetTransform, 0f, direction, null, null, true, false);
        }
        else if (arrow != null)
        {
            arrow.Initialize(targetTransform, 0f, direction, null, true, false);
        }
        else if (proj != null)
        {
            proj.Initialize(targetTransform, 0f, direction, null, null);
        }

        Debug.Log($"[NetworkSync] ‚úÖ Visual projectile created");
    }
    catch (System.Exception e)
    {
        Debug.LogError($"[NetworkSync] Error creating projectile: {e.Message}");
    }
}
```

**–î–æ–±–∞–≤—å—Ç–µ –∫–ª–∞—Å—Å —Å–æ–±—ã—Ç–∏—è (–≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã–≤–∞—é—â–µ–π —Å–∫–æ–±–∫–æ–π namespace):**
```csharp
[System.Serializable]
public class ProjectileSpawnedEvent
{
    public string casterSocketId;
    public int skillId;
    public Vector3Simple spawnPosition;
    public Vector3Simple direction;
    public string targetSocketId;
}
```

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—É—é —á–∞—Å—Ç—å

**–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª:** `Server/server.js`

**–ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é Socket.IO —Å–æ–±—ã—Ç–∏–π –∏ –¥–æ–±–∞–≤—å—Ç–µ:**
```javascript
// Handle projectile spawned
socket.on('projectile_spawned', (data) => {
    try {
        const projectileData = JSON.parse(data);
        console.log(`[Projectile] ${player.username} spawned projectile: skillId=${projectileData.skillId}`);

        // Broadcast to all players in room except sender
        socket.to(player.roomId).emit('projectile_spawned', JSON.stringify({
            casterSocketId: socket.id,
            skillId: projectileData.skillId,
            spawnPosition: projectileData.spawnPosition,
            direction: projectileData.direction,
            targetSocketId: projectileData.targetSocketId || ''
        }));
    } catch (err) {
        console.error('[Projectile] Error:', err);
    }
});
```

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π:

‚úÖ –í—Å–µ –∏–≥—Ä–æ–∫–∏ –≤–∏–¥—è—Ç –ª–µ—Ç—è—â–∏–µ —Å–Ω–∞—Ä—è–¥—ã (Fireball, Arrow, Soul Drain, etc.)
‚úÖ –°–Ω–∞—Ä—è–¥—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–≤–æ–¥—è—Ç—Å—è –Ω–∞ —Ü–µ–ª–∏ (homing)
‚úÖ Trail Renderer –∏ Point Light –≤–∏–¥–Ω—ã –≤—Å–µ–º
‚úÖ –ù–µ—Ç –¥–≤–æ–π–Ω–æ–≥–æ —É—Ä–æ–Ω–∞ (—Å–µ—Ç–µ–≤—ã–µ —Å–Ω–∞—Ä—è–¥—ã –∏–º–µ—é—Ç damage = 0)
‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö 27 —Å–∫–∏–ª–ª–æ–≤ —Å ProjectileDamage —Ç–∏–ø–æ–º

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–≤–∞ –∫–ª–∏–µ–Ω—Ç–∞
2. –ò–≥—Ä–æ–∫ A –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Fireball ‚Üí –ò–≥—Ä–æ–∫ B –≤–∏–¥–∏—Ç –ª–µ—Ç—è—â–∏–π –æ–≥–Ω–µ–Ω–Ω—ã–π —à–∞—Ä
3. –ò–≥—Ä–æ–∫ A –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Rain of Arrows ‚Üí –ò–≥—Ä–æ–∫ B –≤–∏–¥–∏—Ç –≤—Å–µ 3 —Å—Ç—Ä–µ–ª—ã
4. –ò–≥—Ä–æ–∫ A –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Soul Drain ‚Üí –ò–≥—Ä–æ–∫ B –≤–∏–¥–∏—Ç —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π —á–µ—Ä–µ–ø
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —É—Ä–æ–Ω –ø—Ä–∏—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ (–Ω–µ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è)

## ‚ö†Ô∏è –í–ê–ñ–ù–û

- –°–µ—Ç–µ–≤—ã–µ —Å–Ω–∞—Ä—è–¥—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–∏–∑—É–∞–ª—å–Ω–æ (damage = 0)
- –£—Ä–æ–Ω –Ω–∞–Ω–æ—Å–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–Ω–∞—Ä—è–¥–∞
- –°–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É—Ä–æ–Ω–∞ —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
- –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —á–∏—Ç—ã –∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Ä–æ–Ω–∞

## üìÅ –§–ê–ô–õ–´ –ö–û–¢–û–†–´–ï –ù–£–ñ–ù–û –ò–ó–ú–ï–ù–ò–¢–¨

1. ‚úÖ `Assets/Scripts/Skills/ProjectileSyncHelper.cs` - **–£–ñ–ï –°–û–ó–î–ê–ù**
2. ‚ö†Ô∏è `Assets/Scripts/Skills/SkillExecutor.cs` - –¥–æ–±–∞–≤–∏—Ç—å 10 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
3. ‚ö†Ô∏è `Assets/Scripts/Network/NetworkSyncManager.cs` - –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –∏ –∫–ª–∞—Å—Å
4. ‚ö†Ô∏è `Server/server.js` - –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è

–°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤—ã—à–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞.
