# –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢: –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –í–ò–ó–£–ê–õ–¨–ù–´–• –≠–§–§–ï–ö–¢–û–í

**–í—Ä–µ–º—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:** ~15 –º–∏–Ω—É—Ç
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–µ

---

## ‚úÖ –ß–¢–û –£–ñ–ï –°–û–ó–î–ê–ù–û

1. ‚úÖ `ProjectileSyncHelper.cs` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–Ω–∞—Ä—è–¥–æ–≤
2. ‚úÖ `SkillCastAnimationSync.cs` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–Ω–∏–º–∞—Ü–∏–π
3. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞

---

## üöÄ 3 –ü–†–û–°–¢–´–• –®–ê–ì–ê

### –®–ê–ì 1: –î–û–ë–ê–í–ò–¢–¨ –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Æ –°–ù–ê–†–Ø–î–û–í (5 –º–∏–Ω)

#### 1.1 –í SkillExecutor.cs

**–ù–∞–π—Ç–∏:** –ú–µ—Ç–æ–¥ `LaunchProjectile` (~—Å—Ç—Ä–æ–∫–∞ 263)

**–ü–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏:**
```csharp
GameObject projectile = Instantiate(skill.projectilePrefab, spawnPos, Quaternion.LookRotation(direction));
```

**–í—Å—Ç–∞–≤–∏—Ç—å:**
```csharp
// SYNC PROJECTILE
ProjectileSyncHelper syncHelper = projectile.AddComponent<ProjectileSyncHelper>();
string targetSocketId = "";
if (target != null)
{
    NetworkPlayer networkTarget = target.GetComponent<NetworkPlayer>();
    if (networkTarget != null) targetSocketId = networkTarget.socketId;
}
syncHelper.SyncToServer(skill.skillId, spawnPos, direction, targetSocketId);
```

#### 1.2 –í NetworkSyncManager.cs

**–í –º–µ—Ç–æ–¥ `SubscribeToNetworkEvents()` –¥–æ–±–∞–≤–∏—Ç—å:**
```csharp
socketIO.On("projectile_spawned", OnProjectileSpawned);
```

**–í –∫–æ–Ω–µ—Ü –∫–ª–∞—Å—Å–∞ –¥–æ–±–∞–≤–∏—Ç—å:**
```csharp
private void OnProjectileSpawned(string jsonData)
{
    var data = JsonConvert.DeserializeObject<ProjectileSpawnedEvent>(jsonData);
    if (data.casterSocketId == socketIO.GetSocketId()) return;

    SkillConfig[] allSkills = Resources.LoadAll<SkillConfig>("Skills");
    SkillConfig skill = System.Array.Find(allSkills, s => s.skillId == data.skillId);
    if (skill == null || skill.projectilePrefab == null) return;

    Vector3 spawnPos = new Vector3(data.spawnPosition.x, data.spawnPosition.y, data.spawnPosition.z);
    Vector3 direction = new Vector3(data.direction.x, data.direction.y, data.direction.z);
    GameObject projectile = Instantiate(skill.projectilePrefab, spawnPos, Quaternion.LookRotation(direction));

    Transform targetTransform = null;
    if (!string.IsNullOrEmpty(data.targetSocketId) && networkPlayers.ContainsKey(data.targetSocketId))
        targetTransform = networkPlayers[data.targetSocketId].transform;

    var celestial = projectile.GetComponent<CelestialProjectile>();
    var arrow = projectile.GetComponent<ArrowProjectile>();
    var proj = projectile.GetComponent<Projectile>();

    if (celestial != null) celestial.Initialize(targetTransform, 0f, direction, null, null, true, false);
    else if (arrow != null) arrow.Initialize(targetTransform, 0f, direction, null, true, false);
    else if (proj != null) proj.Initialize(targetTransform, 0f, direction, null, null);
}

[System.Serializable]
public class ProjectileSpawnedEvent
{
    public string casterSocketId;
    public int skillId;
    public Vector3Simple spawnPosition;
    public Vector3Simple direction;
    public string targetSocketId;
}
```

#### 1.3 –í Server/server.js

**–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ (–ø–æ—Å–ª–µ –¥—Ä—É–≥–∏—Ö socket.on()):**
```javascript
socket.on('projectile_spawned', (data) => {
    try {
        const projectileData = JSON.parse(data);
        socket.to(player.roomId).emit('projectile_spawned', JSON.stringify({
            casterSocketId: socket.id,
            skillId: projectileData.skillId,
            spawnPosition: projectileData.spawnPosition,
            direction: projectileData.direction,
            targetSocketId: projectileData.targetSocketId || ''
        }));
    } catch (err) {
        console.error('[Projectile] Error:', err);
    }
});
```

---

### –®–ê–ì 2: –î–û–ë–ê–í–ò–¢–¨ –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Æ –ê–ù–ò–ú–ê–¶–ò–ô (5 –º–∏–Ω)

#### 2.1 –í SkillExecutor.cs (–º–µ—Ç–æ–¥ Awake)

**–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω–µ—Ü –º–µ—Ç–æ–¥–∞:**
```csharp
if (GetComponent<SkillCastAnimationSync>() == null)
{
    gameObject.AddComponent<SkillCastAnimationSync>();
}
```

#### 2.2 –í SkillExecutor.cs (–º–µ—Ç–æ–¥ ExecuteSkill)

**–ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–æ–∫, –ø–µ—Ä–µ–¥ `manaSystem.UseMana()`:**
```csharp
// SYNC ANIMATION
SkillCastAnimationSync animSync = GetComponent<SkillCastAnimationSync>();
if (animSync != null && !string.IsNullOrEmpty(skill.animationTrigger))
{
    animSync.PlayCastAnimation(skill.animationTrigger, skill.animationSpeed, skill.castTime);
}
```

#### 2.3 –í NetworkSyncManager.cs

**–í `SubscribeToNetworkEvents()`:**
```csharp
socketIO.On("skill_cast_animation", OnSkillCastAnimation);
```

**–í –∫–æ–Ω–µ—Ü –∫–ª–∞—Å—Å–∞:**
```csharp
private void OnSkillCastAnimation(string jsonData)
{
    var data = JsonConvert.DeserializeObject<SkillCastAnimationEvent>(jsonData);
    if (data.casterSocketId == socketIO.GetSocketId()) return;

    GameObject playerObj = null;
    if (networkPlayers.ContainsKey(data.casterSocketId))
        playerObj = networkPlayers[data.casterSocketId].gameObject;
    if (playerObj == null) return;

    SkillCastAnimationSync animSync = playerObj.GetComponent<SkillCastAnimationSync>();
    if (animSync != null)
        animSync.PlayRemoteCastAnimation(data.animationTrigger, data.animationSpeed);
}

[System.Serializable]
public class SkillCastAnimationEvent
{
    public string casterSocketId;
    public string animationTrigger;
    public float animationSpeed;
    public float castTime;
}
```

#### 2.4 –í Server/server.js

```javascript
socket.on('skill_cast_animation', (data) => {
    try {
        const animData = JSON.parse(data);
        socket.to(player.roomId).emit('skill_cast_animation', JSON.stringify({
            casterSocketId: socket.id,
            animationTrigger: animData.animationTrigger,
            animationSpeed: animData.animationSpeed,
            castTime: animData.castTime
        }));
    } catch (err) {
        console.error('[CastAnim] Error:', err);
    }
});
```

---

### –®–ê–ì 3: –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï (5 –º–∏–Ω)

#### 3.1 –ó–∞–ø—É—Å–∫
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä: `cd Server && npm start`
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–≤–∞ –∫–ª–∏–µ–Ω—Ç–∞ Unity
3. –û–±–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –æ–¥–Ω–æ–π –∫–æ–º–Ω–∞—Ç–µ

#### 3.2 –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç
- [ ] **Fireball** - –≤–∏–¥–µ–Ω —Å–Ω–∞—Ä—è–¥ —É –æ–±–æ–∏—Ö?
- [ ] **Rain of Arrows** - –≤–∏–¥–Ω—ã –≤—Å–µ 3 —Å—Ç—Ä–µ–ª—ã?
- [ ] **Battle Rage** - –≤–∏–¥–Ω–∞ –æ–≥–Ω–µ–Ω–Ω–∞—è –∞—É—Ä–∞?
- [ ] **Teleport** - –≤–∏–¥–µ–Ω –¥—ã–º–æ–∫?

#### 3.3 –ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ `ALL_27_SKILLS_TESTING_CHECKLIST.md`

#### 3.4 –ï—Å–ª–∏ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç ‚ùå
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
- Unity Console: `[ProjectileSync]`, `[CastAnim]`, `[NetworkSync]`
- Server Console: `[Projectile]`, `[CastAnim]`

---

## üìã –§–ê–ô–õ–´ –î–õ–Ø –ò–ó–ú–ï–ù–ï–ù–ò–Ø

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏—è | –°—Ç—Ä–æ–∫ |
|------|-----------|-------|
| `Assets/Scripts/Skills/SkillExecutor.cs` | +15 —Å—Ç—Ä–æ–∫ | 2 –º–µ—Å—Ç–∞ |
| `Assets/Scripts/Network/NetworkSyncManager.cs` | +60 —Å—Ç—Ä–æ–∫ | 2 –º–µ—Ç–æ–¥–∞ + 2 –∫–ª–∞—Å—Å–∞ |
| `Server/server.js` | +30 —Å—Ç—Ä–æ–∫ | 2 –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ |

---

## ‚úÖ –ß–¢–û –ë–£–î–ï–¢ –†–ê–ë–û–¢–ê–¢–¨

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:
- ‚úÖ –í—Å–µ —Å–Ω–∞—Ä—è–¥—ã –≤–∏–¥–Ω—ã –æ–±–æ–∏–º –∏–≥—Ä–æ–∫–∞–º
- ‚úÖ –ê–Ω–∏–º–∞—Ü–∏–∏ –∫–∞—Å—Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ Trail Renderer –∏ Point Light –Ω–∞ —Å–Ω–∞—Ä—è–¥–∞—Ö
- ‚úÖ –ê—É—Ä —ç—Ñ—Ñ–µ–∫—Ç—ã (—É–∂–µ —Ä–∞–±–æ—Ç–∞–ª–∏)
- ‚úÖ Stun/Root –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (—É–∂–µ —Ä–∞–±–æ—Ç–∞–ª–∞)
- ‚úÖ –í—Å–µ 27 —Å–∫–∏–ª–ª–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã

---

## üìö –ü–û–õ–ù–ê–Ø –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

–ï—Å–ª–∏ –Ω—É–∂–Ω—ã –¥–µ—Ç–∞–ª–∏:
1. `MULTIPLAYER_VISUAL_EFFECTS_SOLUTION.md` - –ø–æ–ª–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
2. `VISUAL_EFFECTS_SYNC_COMPLETE_GUIDE.md` - –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
3. `ALL_27_SKILLS_TESTING_CHECKLIST.md` - —á–µ–∫-–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
4. `QUICK_PROJECTILE_SYNC_GUIDE.md` - —Ç–æ–ª—å–∫–æ —Å–Ω–∞—Ä—è–¥—ã

---

**–í—Ä–µ–º—è:** ~15 –º–∏–Ω—É—Ç
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è (–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å-–≤—Å—Ç–∞–≤–∏—Ç—å)
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤! üéâ
