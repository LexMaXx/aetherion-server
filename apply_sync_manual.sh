#!/bin/bash
# –†—É—á–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ç—á–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å–Ω–∞—Ä—è–¥–æ–≤

FILE="Assets/Scripts/Skills/SkillExecutor.cs"

echo "Applying projectile sync patch to $FILE..."

# –°–æ–∑–¥–∞—ë–º backup
cp "$FILE" "$FILE.backup"

# –ò—Å–ø–æ–ª—å–∑—É–µ–º sed –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –∫–æ–¥–∞ –ø–æ—Å–ª–µ GameObject projectile = Instantiate
sed -i '/GameObject projectile = Instantiate.*LookRotation.*direction/a\
\
        // üöÄ MULTIPLAYER SYNC: Send projectile to server for other players to see\
        string targetSocketId = "";\
        if (target != null)\
        {\
            NetworkPlayer networkTarget = target.GetComponent<NetworkPlayer>();\
            if (networkTarget != null)\
            {\
                targetSocketId = networkTarget.socketId;\
            }\
        }\
\
        SocketIOManager socketIO = SocketIOManager.Instance;\
        if (socketIO != null && socketIO.IsConnected)\
        {\
            socketIO.SendProjectileSpawned(skill.skillId, spawnPos, direction, targetSocketId);\
            Log($"üåê Projectile synced to server: {skill.skillName}");\
        }' "$FILE"

echo "‚úÖ Patch applied! Backup saved as $FILE.backup"
echo "Please verify the changes in Unity"
