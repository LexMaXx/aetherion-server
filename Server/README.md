# üéÆ Aetherion MMO Server

Multiplayer server for Aetherion Unity game using Socket.IO and MongoDB.

## üìã Features

- ‚úÖ REST API –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ª–æ–≥–∏–Ω)
- ‚úÖ REST API –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π (—Å–æ–∑–¥–∞–Ω–∏–µ, –≤—ã–±–æ—Ä)
- ‚úÖ REST API –¥–ª—è –∫–æ–º–Ω–∞—Ç (—Å–æ–∑–¥–∞–Ω–∏–µ, –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ)
- ‚úÖ WebSocket (Socket.IO) –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–∞—Ä—Ç –ª–æ–±–±–∏ –ø—Ä–∏ 2+ –∏–≥—Ä–æ–∫–∞—Ö
- ‚úÖ Countdown 3-2-1 –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∏–≥—Ä—ã
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π, –∞–Ω–∏–º–∞—Ü–∏–π, –∞—Ç–∞–∫
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–Ω–∞—Ä—è–¥–æ–≤ –∏ —Å–∫–∏–ª–ª–æ–≤
- ‚úÖ MongoDB –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

---

## üöÄ Quick Start

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
cd Server
npm install
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:

```env
PORT=3000
MONGODB_URI=mongodb://localhost:27017/aetherion
JWT_SECRET=your-super-secret-key-change-this
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å MongoDB (–µ—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ)

```bash
# Windows
mongod

# Linux/Mac
sudo systemctl start mongod
```

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä

```bash
# Production
npm start

# Development (auto-reload)
npm run dev
```

–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://localhost:3000`

---

## üì° API Endpoints

### Authentication

#### POST `/api/auth/register`
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Request:**
```json
{
  "username": "player1",
  "email": "player1@example.com",
  "password": "password123"
}
```

**Response:**
```json
{
  "success": true,
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": "507f1f77bcf86cd799439011",
    "username": "player1",
    "email": "player1@example.com"
  }
}
```

#### POST `/api/auth/login`
–í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Request:**
```json
{
  "username": "player1",
  "password": "password123"
}
```

**Response:**
```json
{
  "success": true,
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": "507f1f77bcf86cd799439011",
    "username": "player1",
    "email": "player1@example.com"
  }
}
```

#### GET `/api/auth/verify`
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞

**Headers:**
```
Authorization: Bearer <token>
```

**Response:**
```json
{
  "success": true,
  "user": {
    "userId": "507f1f77bcf86cd799439011",
    "username": "player1"
  }
}
```

---

### Characters

#### GET `/api/character`
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Headers:**
```
Authorization: Bearer <token>
```

**Response:**
```json
{
  "success": true,
  "characters": [
    {
      "id": "507f1f77bcf86cd799439012",
      "characterClass": "Mage",
      "level": 5,
      "gold": 1000,
      "stats": {
        "strength": 5,
        "perception": 5,
        "endurance": 5,
        "wisdom": 10,
        "intelligence": 15,
        "agility": 7,
        "luck": 8
      }
    }
  ]
}
```

#### POST `/api/character/select`
–í—ã–±—Ä–∞—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞

**Headers:**
```
Authorization: Bearer <token>
```

**Request:**
```json
{
  "characterClass": "Mage"
}
```

**Response:**
```json
{
  "success": true,
  "character": {
    "id": "507f1f77bcf86cd799439012",
    "characterClass": "Mage",
    "level": 1,
    "gold": 0,
    "stats": {
      "strength": 5,
      "perception": 5,
      "endurance": 5,
      "wisdom": 5,
      "intelligence": 5,
      "agility": 5,
      "luck": 5
    }
  }
}
```

---

### Rooms

#### POST `/api/room/create`
–°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É

**Headers:**
```
Authorization: Bearer <token>
```

**Request:**
```json
{
  "roomName": "My Room",
  "maxPlayers": 20,
  "characterClass": "Mage",
  "username": "player1"
}
```

**Response:**
```json
{
  "success": true,
  "room": {
    "roomId": "a1b2c3d4e5f6...",
    "roomName": "My Room",
    "maxPlayers": 20,
    "playerCount": 0
  }
}
```

---

## üîå WebSocket Events

### Client ‚Üí Server

#### `join_room`
–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ

**Emit:**
```javascript
socket.emit('join_room', {
  roomId: "a1b2c3d4e5f6...",
  characterClass: "Mage"
});
```

**Response:**
```javascript
socket.on('join_room_success', (data) => {
  // data = { roomId, spawnIndex }
});
```

#### `room_players_request`
–ó–∞–ø—Ä–æ—Å–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ –≤ –∫–æ–º–Ω–∞—Ç–µ

**Emit:**
```javascript
socket.emit('room_players_request', {
  roomId: "a1b2c3d4e5f6..."
});
```

**Response:**
```javascript
socket.on('room_players', (data) => {
  // data = { players: [...], yourSocketId, yourSpawnIndex }
});
```

#### `update_position`
–û–±–Ω–æ–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é –∏–≥—Ä–æ–∫–∞

**Emit:**
```javascript
socket.emit('update_position', {
  position: { x: 10, y: 0, z: 5 },
  rotation: { x: 0, y: 90, z: 0 },
  velocity: { x: 1, y: 0, z: 0 },
  isMoving: true
});
```

#### `update_animation`
–û–±–Ω–æ–≤–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é –∏–≥—Ä–æ–∫–∞

**Emit:**
```javascript
socket.emit('update_animation', {
  animationState: "Running"
});
```

#### `player_used_skill`
–ò–≥—Ä–æ–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Å–∫–∏–ª–ª

**Emit:**
```javascript
socket.emit('player_used_skill', {
  skillName: "Fireball",
  skillType: "Projectile",
  targetPosition: { x: 15, y: 0, z: 10 }
});
```

#### `projectile_spawned`
–°–æ–∑–¥–∞–Ω —Å–Ω–∞—Ä—è–¥

**Emit:**
```javascript
socket.emit('projectile_spawned', {
  projectileType: "CelestialProjectile",
  spawnPosition: { x: 10, y: 1.5, z: 5 },
  direction: { x: 1, y: 0, z: 0 },
  targetId: "socketId123",
  damage: 50,
  speed: 10
});
```

---

### Server ‚Üí Client

#### `lobby_created`
–õ–æ–±–±–∏ —Å–æ–∑–¥–∞–Ω–æ (2+ –∏–≥—Ä–æ–∫–æ–≤)

**Data:**
```javascript
{
  waitTime: 17000 // milliseconds
}
```

#### `game_countdown`
Countdown –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º

**Data:**
```javascript
{
  count: 3 // 3, 2, 1
}
```

#### `game_start`
–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å - —Å–ø–∞–≤–Ω–∏–º –≤—Å–µ—Ö!

**Data:**
```javascript
{
  players: [
    {
      socketId: "abc123",
      username: "player1",
      characterClass: "Mage",
      spawnIndex: 0,
      position: { x: 0, y: 0, z: 0 },
      stats: { ... }
    },
    ...
  ]
}
```

#### `player_joined`
–ù–æ–≤—ã–π –∏–≥—Ä–æ–∫ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è

**Data:**
```javascript
{
  socketId: "xyz789",
  username: "player2",
  characterClass: "Warrior",
  spawnIndex: 1,
  stats: { ... }
}
```

#### `player_moved`
–ò–≥—Ä–æ–∫ –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª—Å—è

**Data:**
```javascript
{
  socketId: "abc123",
  position: { x: 10, y: 0, z: 5 },
  rotation: { x: 0, y: 90, z: 0 },
  velocity: { x: 1, y: 0, z: 0 },
  isMoving: true
}
```

#### `player_animation_changed`
–ê–Ω–∏–º–∞—Ü–∏—è –∏–≥—Ä–æ–∫–∞ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å

**Data:**
```javascript
{
  socketId: "abc123",
  animationState: "Running"
}
```

---

## üéÆ Game Flow

### 1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
```
1. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST /api/auth/login
2. –ü–æ–ª—É—á–∞–µ—Ç JWT token
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç token –≤ PlayerPrefs
```

### 2. –í—ã–±–æ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
```
1. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST /api/character/select
2. –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (–∫–ª–∞—Å—Å, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏)
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ PlayerPrefs
```

### 3. –°–æ–∑–¥–∞–Ω–∏–µ/–ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–æ–º–Ω–∞—Ç–µ
```
1. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST /api/room/create (–∏–ª–∏ join)
2. –ü–æ–ª—É—á–∞–µ—Ç roomId
3. –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ WebSocket —Å —Ç–æ–∫–µ–Ω–æ–º
4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç join_room —Å roomId –∏ –∫–ª–∞—Å—Å–æ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
```

### 4. –û–∂–∏–¥–∞–Ω–∏–µ –≤ –ª–æ–±–±–∏
```
1. –ü–µ—Ä–≤—ã–π –∏–≥—Ä–æ–∫ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è ‚Üí –∂–¥–µ—Ç
2. –í—Ç–æ—Ä–æ–π –∏–≥—Ä–æ–∫ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è ‚Üí —Å–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç lobby_created
3. –ñ–¥–µ–º 14 —Å–µ–∫—É–Ω–¥
4. –°–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç game_countdown (3, 2, 1)
5. –°–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç game_start
6. –í—Å–µ –∏–≥—Ä–æ–∫–∏ —Å–ø–∞–≤–Ω—è—Ç—Å—è –û–î–ù–û–í–†–ï–ú–ï–ù–ù–û!
```

### 5. –ò–≥—Ä–∞
```
1. –ö–ª–∏–µ–Ω—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç update_position, update_animation
2. –°–µ—Ä–≤–µ—Ä —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç –≤—Å–µ–º –≤ –∫–æ–º–Ω–∞—Ç–µ
3. –ü—Ä–∏ –∞—Ç–∞–∫–∞—Ö/—Å–∫–∏–ª–ª–∞—Ö: projectile_spawned, visual_effect_spawned
4. –°–µ—Ä–≤–µ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ —Å–æ–±—ã—Ç–∏—è
```

---

## üîß Development

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ MongoDB

–°–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ë–ï–ó MongoDB –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ:
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –±—É–¥–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
- –ù–æ WebSocket –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–µ—Ä–≤–µ—Ä –≤—ã–≤–æ–¥–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏:
```
‚úÖ Socket connected: abc123 (user: player1)
[abc123] Joining room: xyz789 as Mage
[Room xyz789] Created
[Room xyz789] Player player1 joined (1/20)
[Room xyz789] Player player2 joined (2/20)
[Room xyz789] üèÅ LOBBY STARTED (2 players)
[Room xyz789] ‚è±Ô∏è COUNTDOWN STARTED
[Room xyz789] Countdown: 3
[Room xyz789] Countdown: 2
[Room xyz789] Countdown: 1
[Room xyz789] üéÆ GAME STARTED
```

---

## üì¶ –î–µ–ø–ª–æ–π –Ω–∞ Render.com

### 1. –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ Render.com

### 2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

### 3. –°–æ–∑–¥–∞—Ç—å Web Service

- **Build Command:** `npm install`
- **Start Command:** `npm start`
- **Environment Variables:**
  - `MONGODB_URI` - MongoDB connection string
  - `JWT_SECRET` - –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è JWT
  - `PORT` - –ü–æ—Ä—Ç (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç Render)

### 4. –ü–æ–¥–∫–ª—é—á–∏—Ç—å MongoDB Atlas (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)

1. –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ [MongoDB Atlas](https://www.mongodb.com/cloud/atlas)
2. –°–æ–∑–¥–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä
3. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å connection string
4. –î–æ–±–∞–≤–∏—Ç—å –≤ `MONGODB_URI` –Ω–∞ Render

---

## üêõ Troubleshooting

### –°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** `Error: Cannot find module 'express'`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
npm install
```

---

### MongoDB connection error

**–ü—Ä–æ–±–ª–µ–º–∞:** `MongooseServerSelectionError`

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ MongoDB –∑–∞–ø—É—â–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ
2. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ MongoDB Atlas
3. –ò–ª–∏ —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ "–±–µ–∑ –ë–î"

---

### WebSocket –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–ª–∏–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ WebSocket

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `serverUrl` –≤ Unity (SocketIOManager.cs)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

---

## üìä Statistics

**REST API Endpoints:** 7
**WebSocket Events (Client ‚Üí Server):** 10
**WebSocket Events (Server ‚Üí Client):** 15

---

## üìù License

MIT

---

## üë• Authors

Aetherion Team

---

**Ready to deploy!** üöÄ
