# üêõ –ë–ê–ì –ò–°–ü–†–ê–í–õ–ï–ù: NullReferenceException

**–î–∞—Ç–∞**: 2025-10-12
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

---

## üîç –ü–†–û–ë–õ–ï–ú–ê

### –û—à–∏–±–∫–∞:
```
NullReferenceException: Object reference not set to an instance of an object
RoomManager.ConnectToWebSocket (System.String roomId, System.String characterClass, System.Action`1[T] onComplete) (at Assets/Scripts/Network/RoomManager.cs:380)
```

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ:
1. ‚úÖ –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É —Ä–∞–±–æ—Ç–∞–ª
2. ‚úÖ REST API –≤—Ö–æ–¥ –≤ –∫–æ–º–Ω–∞—Ç—É —Ä–∞–±–æ—Ç–∞–ª
3. ‚ùå **UnifiedSocketIO.Instance –±—ã–ª null** –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ WebSocket

### –ü—Ä–∏—á–∏–Ω–∞:
`NetworkInitializer` —Å–æ–∑–¥–∞—ë—Ç `UnifiedSocketIO` –≤ `IntroScene`, –Ω–æ –µ—Å–ª–∏ –∏–≥—Ä–æ–∫ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ `GameScene` –Ω–∞–ø—Ä—è–º—É—é (–º–∏–Ω—É—è IntroScene), —Ç–æ `UnifiedSocketIO` –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è.

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï

### –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∞–≤—Ç–æ-—Å–æ–∑–¥–∞–Ω–∏–µ UnifiedSocketIO

**–î–æ** (—Å—Ç—Ä–æ–∫–∞ 375 –≤ RoomManager.cs):
```csharp
private void ConnectToWebSocket(string roomId, string characterClass, Action<bool> onComplete)
{
    string token = PlayerPrefs.GetString("UserToken", "");

    // Connect to UnifiedSocketIO
    UnifiedSocketIO.Instance.Connect(token, (success) =>  // ‚ùå NullReferenceException!
```

**–ü–æ—Å–ª–µ** (—Å—Ç—Ä–æ–∫–∞ 375 –≤ RoomManager.cs):
```csharp
private void ConnectToWebSocket(string roomId, string characterClass, Action<bool> onComplete)
{
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ UnifiedSocketIO
    if (UnifiedSocketIO.Instance == null)
    {
        Debug.LogWarning("[RoomManager] UnifiedSocketIO –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞—ë–º...");
        GameObject socketGO = new GameObject("UnifiedSocketIO");
        socketGO.AddComponent<UnifiedSocketIO>();
        DontDestroyOnLoad(socketGO);
    }

    string token = PlayerPrefs.GetString("UserToken", "");

    // Connect to UnifiedSocketIO
    UnifiedSocketIO.Instance.Connect(token, (success) =>  // ‚úÖ –¢–µ–ø–µ—Ä—å Instance –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!
```

---

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢

### –¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. ‚úÖ `UnifiedSocketIO` —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
2. ‚úÖ –ù–µ –≤–∞–∂–Ω–æ, —á–µ—Ä–µ–∑ –∫–∞–∫—É—é —Å—Ü–µ–Ω—É –∏–≥—Ä–æ–∫ –ø–æ–ø–∞–ª –≤ GameScene
3. ‚úÖ `DontDestroyOnLoad` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –æ–±—ä–µ–∫—Ç –Ω–µ —É–Ω–∏—á—Ç–æ–∂–∏—Ç—Å—è –º–µ–∂–¥—É —Å—Ü–µ–Ω–∞–º–∏
4. ‚úÖ –õ–æ–≥–∏ –ø–æ–∫–∞–∂—É—Ç, –µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç –±—ã–ª —Å–æ–∑–¥–∞–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏

---

## üìù –ß–¢–û –¢–ï–°–¢–ò–†–û–í–ê–¢–¨ –î–ê–õ–¨–®–ï

### –®–∞–≥ 1: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ Unity
1. **–û—Å—Ç–∞–Ω–æ–≤–∏ –∏–≥—Ä—É** (Stop)
2. **–î–æ–∂–¥–∏—Å—å –ø–µ—Ä–µ–∫–æ–º–ø–∏–ª—è—Ü–∏–∏** (Unity –ø–µ—Ä–µ–∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç RoomManager.cs)
3. **–ü—Ä–æ–≤–µ—Ä—å Console** - –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

### –®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏ –∏–≥—Ä—É —Å–Ω–æ–≤–∞
1. **–ù–∞–∂–º–∏ Play** ‚ñ∂Ô∏è
2. **–í–æ–π–¥–∏ –≤ —Å–∏—Å—Ç–µ–º—É**
3. **–í—ã–±–µ—Ä–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞**
4. **–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É "Battle" (–ø–µ—Ä–µ—Ö–æ–¥ –≤ –∞—Ä–µ–Ω—É)**

### –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:
```
[RoomManager] –í–æ—à–ª–∏ –≤ –∫–æ–º–Ω–∞—Ç—É, –ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è —á–µ—Ä–µ–∑ WebSocket...
[RoomManager] UnifiedSocketIO –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞—ë–º...  ‚¨ÖÔ∏è –ù–û–í–´–ô –õ–û–ì
[SocketIO] ‚úÖ UnifiedSocketIO initialized
[SocketIO] üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ https://aetherion-server-gv5u.onrender.com...
[SocketIO] ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ! Session ID: abc123xyz
[RoomManager] üöÄ Socket.IO –ø–æ–¥–∫–ª—é—á–µ–Ω, –≤—Ö–æ–¥–∏–º –≤ –∫–æ–º–Ω–∞—Ç—É...
[SocketIO] üö™ –í—Ö–æ–¥ –≤ –∫–æ–º–Ω–∞—Ç—É: 0eb9ef7b-79c3-4d4b-9cb2-3b50294fde04 –∫–∞–∫ Mage
[SocketIO] üì§ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: join_room
[SocketIO] üì® –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ: room_players
[RoomManager] ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ –∏–≥—Ä–µ!
```

### ‚ùå –ï—Å–ª–∏ –æ—à–∏–±–∫–∞:
–ü—Ä–∏—à–ª–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç Console —Å –Ω–æ–≤—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏!

---

## üí° –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø

### –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü–∞—Ç—Ç–µ—Ä–Ω Singleton**:
   - `UnifiedSocketIO` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω Singleton
   - `Instance` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ `Awake()`
   - –ï—Å–ª–∏ `Instance == null`, –∑–Ω–∞—á–∏—Ç –æ–±—ä–µ–∫—Ç –Ω–µ —Å–æ–∑–¥–∞–Ω

2. **DontDestroyOnLoad**:
   - –û–±—ä–µ–∫—Ç –Ω–µ —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ü–µ–Ω
   - –°–æ–∑–¥–∞—ë—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∏ –∂–∏–≤—ë—Ç –¥–æ –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã

3. **Lazy Initialization**:
   - –°–æ–∑–¥–∞—ë–º –æ–±—ä–µ–∫—Ç —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –æ–Ω –Ω—É–∂–µ–Ω
   - –ù–µ –∑–∞–≤–∏—Å–∏–º –æ—Ç –ø–æ—Ä—è–¥–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ü–µ–Ω

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞:
1. **–°–æ–∑–¥–∞—Ç—å Build**
2. **–ó–∞–ø—É—Å—Ç–∏—Ç—å 2 –∫–ª–∏–µ–Ω—Ç–∞**
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –∏–≥—Ä–æ–∫–æ–≤**

---

**–ü–ï–†–ï–ó–ê–ü–£–°–¢–ò UNITY –ò –ü–û–ü–†–û–ë–£–ô –°–ù–û–í–ê!** üéÆ
