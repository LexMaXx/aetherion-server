# –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò –°–ù–ê–†–Ø–î–û–í –ò –í–ò–ó–£–ê–õ–¨–ù–´–• –≠–§–§–ï–ö–¢–û–í

## –ü—Ä–æ–±–ª–µ–º–∞
–°–Ω–∞—Ä—è–¥—ã –∏ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –Ω–µ –≤–∏–¥–Ω—ã –¥—Ä—É–≥–∏–º –∏–≥—Ä–æ–∫–∞–º –≤ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ:
1. `SendProjectileSpawned` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ LaunchProjectile()
2. –í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –∫–∞—Å—Ç–∞ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è
3. –≠—Ñ—Ñ–µ–∫—Ç—ã –ø–æ–ø–∞–¥–∞–Ω–∏—è (explosions) –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä

## –†–µ—à–µ–Ω–∏–µ 1: –î–æ–±–∞–≤–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Å–Ω–∞—Ä—è–¥–æ–≤

### –í —Ñ–∞–π–ª–µ `Assets/Scripts/Skills/SkillExecutor.cs`

**–ü–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 281** (–ø–æ—Å–ª–µ `GameObject projectile = Instantiate...`):

```csharp
        GameObject projectile = Instantiate(skill.projectilePrefab, spawnPos, Quaternion.LookRotation(direction));

        // üöÄ –ù–û–í–û–ï: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–Ω–∞—Ä—è–¥–∞ –≤ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–µ
        string targetSocketId = "";
        if (target != null)
        {
            NetworkPlayer networkTarget = target.GetComponent<NetworkPlayer>();
            if (networkTarget != null)
            {
                targetSocketId = networkTarget.socketId;
            }
        }

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤
        SocketIOManager socketIO = SocketIOManager.Instance;
        if (socketIO != null && socketIO.IsConnected)
        {
            socketIO.SendProjectileSpawned(skill.skillId, spawnPos, direction, targetSocketId);
            Log($"üåê –°–Ω–∞—Ä—è–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä: {skill.skillName}");
        }

        // Try CelestialProjectile first (for mage)
        CelestialProjectile celestialProj = projectile.GetComponent<CelestialProjectile>();
```

## –†–µ—à–µ–Ω–∏–µ 2: –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–Ω–∞—Ä—è–¥–æ–≤ –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞—Ö

### –í —Ñ–∞–π–ª–µ `Assets/Scripts/Network/NetworkSyncManager.cs`

–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è `projectile_spawned` –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞, —á—Ç–æ–±—ã –¥—Ä—É–≥–∏–µ –∏–≥—Ä–æ–∫–∏ –≤–∏–¥–µ–ª–∏ –ª–µ—Ç—è—â–∏–µ —Å–Ω–∞—Ä—è–¥—ã.

**–î–æ–±–∞–≤–∏—Ç—å –≤ SubscribeToNetworkEvents():**

```csharp
socketIO.On("projectile_spawned", OnProjectileSpawned);
```

**–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥:**

```csharp
private void OnProjectileSpawned(string jsonData)
{
    try
    {
        var data = JsonConvert.DeserializeObject<ProjectileSpawnedEvent>(jsonData);

        Debug.Log($"[NetworkSync] üöÄ –ü–æ–ª—É—á–µ–Ω —Å–Ω–∞—Ä—è–¥ –æ—Ç {data.casterSocketId}: skillId={data.skillId}");

        // –ù–µ —Å–æ–∑–¥–∞—ë–º —Å–Ω–∞—Ä—è–¥ –¥–ª—è —Å–µ–±—è (—É –Ω–∞—Å –æ–Ω —É–∂–µ –µ—Å—Ç—å)
        if (data.casterSocketId == socketIO.GetSocketId())
        {
            Debug.Log("[NetworkSync] –≠—Ç–æ –Ω–∞—à —Å–Ω–∞—Ä—è–¥, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º");
            return;
        }

        // –ù–∞–π—Ç–∏ SkillConfig –ø–æ ID
        SkillConfig skill = LoadSkillById(data.skillId);
        if (skill == null || skill.projectilePrefab == null)
        {
            Debug.LogWarning($"[NetworkSync] –ù–µ –Ω–∞–π–¥–µ–Ω –ø—Ä–µ—Ñ–∞–± —Å–Ω–∞—Ä—è–¥–∞ –¥–ª—è skillId={data.skillId}");
            return;
        }

        // –°–æ–∑–¥–∞—Ç—å —Å–Ω–∞—Ä—è–¥ –≤–∏–∑—É–∞–ª—å–Ω–æ
        Vector3 spawnPos = new Vector3(data.spawnPosition.x, data.spawnPosition.y, data.spawnPosition.z);
        Vector3 direction = new Vector3(data.direction.x, data.direction.y, data.direction.z);

        GameObject projectile = Instantiate(skill.projectilePrefab, spawnPos, Quaternion.LookRotation(direction));

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–ë–ï–ó —É—Ä–æ–Ω–∞)
        Projectile proj = projectile.GetComponent<Projectile>();
        if (proj != null)
        {
            Transform targetTransform = null;
            if (!string.IsNullOrEmpty(data.targetSocketId))
            {
                // –ù–∞–π—Ç–∏ —Ü–µ–ª—å —Å—Ä–µ–¥–∏ —Å–µ—Ç–µ–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
                if (networkPlayers.ContainsKey(data.targetSocketId))
                {
                    targetTransform = networkPlayers[data.targetSocketId].transform;
                }
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–∑—É–∞–ª—å–Ω–æ (damage = 0, isFromNetwork = true)
            proj.Initialize(targetTransform, 0f, direction, null, null);
            proj.DisableDamage(); // –ú–µ—Ç–æ–¥ —á—Ç–æ–±—ã —Å–Ω–∞—Ä—è–¥ –Ω–µ –Ω–∞–Ω–æ—Å–∏–ª —É—Ä–æ–Ω
        }

        Debug.Log($"[NetworkSync] ‚úÖ –°–Ω–∞—Ä—è–¥ —Å–æ–∑–¥–∞–Ω –≤–∏–∑—É–∞–ª—å–Ω–æ");
    }
    catch (System.Exception e)
    {
        Debug.LogError($"[NetworkSync] –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–Ω–∞—Ä—è–¥–∞: {e.Message}");
    }
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫–∏–ª–ª–∞ –ø–æ ID
private SkillConfig LoadSkillById(int skillId)
{
    SkillConfig[] allSkills = Resources.LoadAll<SkillConfig>("Skills");
    foreach (SkillConfig skill in allSkills)
    {
        if (skill.skillId == skillId)
        {
            return skill;
        }
    }
    return null;
}
```

**–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∞—Å—Å —Å–æ–±—ã—Ç–∏—è:**

```csharp
[System.Serializable]
public class ProjectileSpawnedEvent
{
    public string casterSocketId;
    public int skillId;
    public Vector3Simple spawnPosition;
    public Vector3Simple direction;
    public string targetSocketId;
}
```

## –†–µ—à–µ–Ω–∏–µ 3: –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ DisableDamage –≤ —Å–Ω–∞—Ä—è–¥–∞—Ö

### –í —Ñ–∞–π–ª–µ `Assets/Scripts/Player/Projectile.cs`

```csharp
private bool isNetworkVisualOnly = false; // –§–ª–∞–≥ –¥–ª—è —Å–µ—Ç–µ–≤—ã—Ö —Å–Ω–∞—Ä—è–¥–æ–≤

public void DisableDamage()
{
    isNetworkVisualOnly = true;
}

// –í –º–µ—Ç–æ–¥–µ HitTarget() –≤ –Ω–∞—á–∞–ª–µ:
private void HitTarget()
{
    if (isNetworkVisualOnly)
    {
        // –≠—Ç–æ –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Å–Ω–∞—Ä—è–¥, –Ω–µ –Ω–∞–Ω–æ—Å–∏–º —É—Ä–æ–Ω
        Destroy(gameObject);
        return;
    }

    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
}
```

## –†–µ—à–µ–Ω–∏–µ 4: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –∫–∞—Å—Ç–∞

### –í —Ñ–∞–π–ª–µ `Assets/Scripts/Skills/SkillExecutor.cs`

–ò–∑–º–µ–Ω–∏—Ç—å –º–µ—Ç–æ–¥ `SpawnEffect`:

**–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è:**
```csharp
private void SpawnEffect(GameObject effectPrefab, Vector3 position, Quaternion rotation)
```

**–ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π:**
```csharp
private void SpawnEffect(GameObject effectPrefab, Vector3 position, Quaternion rotation, bool syncToNetwork = false)
{
    if (effectPrefab == null) return;

    GameObject effect = Instantiate(effectPrefab, position, rotation);

    // üåê –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–µ
    if (syncToNetwork)
    {
        SocketIOManager socketIO = SocketIOManager.Instance;
        if (socketIO != null && socketIO.IsConnected)
        {
            socketIO.SendVisualEffect(
                "cast",
                effectPrefab.name,
                position,
                rotation,
                "", // targetSocketId –ø—É—Å—Ç–æ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –∫–∞—Å—Ç–∞
                3f, // duration
                null
            );
            Log($"üé® –≠—Ñ—Ñ–µ–∫—Ç –∫–∞—Å—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä: {effectPrefab.name}");
        }
    }

    Destroy(effect, 3f);
}
```

**–í LaunchProjectile() –∏–∑–º–µ–Ω–∏—Ç—å –≤—ã–∑–æ–≤:**
```csharp
SpawnEffect(skill.castEffectPrefab, spawnPos, Quaternion.identity, true); // true = —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚úÖ –í—Å–µ –∏–≥—Ä–æ–∫–∏ –≤–∏–¥—è—Ç –ª–µ—Ç—è—â–∏–µ —Å–Ω–∞—Ä—è–¥—ã
- ‚úÖ –°–Ω–∞—Ä—è–¥—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å Trail Renderer –∏ Point Light
- ‚úÖ –≠—Ñ—Ñ–µ–∫—Ç—ã –∫–∞—Å—Ç–∞ (cast effects) –≤–∏–¥–Ω—ã –≤—Å–µ–º –∏–≥—Ä–æ–∫–∞–º
- ‚úÖ –°–Ω–∞—Ä—è–¥—ã –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ –Ω–µ –Ω–∞–Ω–æ—Å—è—Ç –¥–≤–æ–π–Ω–æ–π —É—Ä–æ–Ω (—Ç–æ–ª—å–∫–æ –≤–∏–∑—É–∞–ª)
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö 27 —Å–∫–∏–ª–ª–æ–≤

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–≤–∞ –∫–ª–∏–µ–Ω—Ç–∞
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Fireball (Mage) - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∏–¥–µ–Ω —É –æ–±–æ–∏—Ö
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Rain of Arrows (Archer) - –≤—Å–µ 3 —Å—Ç—Ä–µ–ª—ã –≤–∏–¥–Ω—ã
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Life Steal —ç—Ñ—Ñ–µ–∫—Ç (Soul Drain) - —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π —á–µ—Ä–µ–ø –≤–∏–¥–µ–Ω –æ–±–æ–∏–º
5. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —É—Ä–æ–Ω –ø—Ä–∏—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ (–æ—Ç —Å–µ—Ä–≤–µ—Ä–∞)
