# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥–∏ —Å–æ–±—ã—Ç–∏–π - 226 actions

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∏–≥—Ä—ã –≤ Console –ø–æ—è–≤–ª—è–ª–æ—Å—å —Å–æ–æ–±—â–µ–Ω–∏–µ:
```
[MainThreadDispatcher] üîß Action –¥–æ–±–∞–≤–ª–µ–Ω –≤ –æ—á–µ—Ä–µ–¥—å. –í—Å–µ–≥–æ –≤ –æ—á–µ—Ä–µ–¥–∏: 226
```

**226 –¥–µ–π—Å—Ç–≤–∏–π –≤ –æ—á–µ—Ä–µ–¥–∏** - —ç—Ç–æ –æ–≥—Ä–æ–º–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ! –ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–ª–∞ —Ç–æ—Ä–º–æ–∑–∏—Ç—å –∏–∑-–∑–∞ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –ª–æ–≥–∞–º–∏.

## –ü—Ä–∏—á–∏–Ω–∞

–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ **–∏–∑–±—ã—Ç–æ—á–Ω–æ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏**. –ö–∞–∂–¥–æ–µ —Å–µ—Ç–µ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ (`player_moved`, `player_animation_changed` –∏ —Ç.–¥.) —Å–æ–∑–¥–∞–≤–∞–ª–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ Debug.Log –≤—ã–∑–æ–≤–æ–≤:

1. **UnityMainThreadDispatcher.Enqueue()** - –ª–æ–≥–∏—Ä–æ–≤–∞–ª –∫–∞–∂–¥–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å
2. **NetworkSyncManager.OnPlayerMoved()** - –ª–æ–≥–∏—Ä–æ–≤–∞–ª –∫–∞–∂–¥–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ (10 —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É!)
3. **NetworkSyncManager.SyncLocalPlayerPosition()** - –ª–æ–≥–∏—Ä–æ–≤–∞–ª –æ—Ç–ø—Ä–∞–≤–∫—É –ø–æ–∑–∏—Ü–∏–∏
4. **NetworkSyncManager.Update()** - –ª–æ–≥–∏—Ä–æ–≤–∞–ª –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä

–ü—Ä–∏ —á–∞—Å—Ç–æ—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è 10 Hz (10 —Å–æ–±—ã—Ç–∏–π –≤ —Å–µ–∫—É–Ω–¥—É) –∏ 2 –∏–≥—Ä–æ–∫–∞—Ö –≤ –∫–æ–º–Ω–∞—Ç–µ:
- **player_moved**: 10 —Å–æ–±—ã—Ç–∏–π/—Å–µ–∫ √ó 2 –∏–≥—Ä–æ–∫–∞ = 20 —Å–æ–±—ã—Ç–∏–π/—Å–µ–∫
- –ö–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ = **5 –ª–æ–≥–æ–≤**
- **–ò—Ç–æ–≥–æ**: 20 √ó 5 = **100 –ª–æ–≥–æ–≤/—Å–µ–∫** = **6000 –ª–æ–≥–æ–≤/–º–∏–Ω—É—Ç—É** üî•

## –†–µ—à–µ–Ω–∏–µ

–£–±—Ä–∞–ª–∏ –≤—Å–µ –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ Debug.Log –∏–∑ –≥–æ—Ä—è—á–∏—Ö –ø—É—Ç–µ–π:

### 1. UnityMainThreadDispatcher.cs ‚úÖ
**–£–±—Ä–∞–ª–∏ –ª–æ–≥–∏**:
- `Enqueue()` - –±–æ–ª—å—à–µ –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç –∫–∞–∂–¥–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ (–±—ã–ª–æ 226 –ª–æ–≥–æ–≤!)
- `Update()` - –±–æ–ª—å—à–µ –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—á–µ—Ä–µ–¥–∏

**–î–æ**:
```csharp
Debug.Log($"[MainThreadDispatcher] üîß Action –¥–æ–±–∞–≤–ª–µ–Ω –≤ –æ—á–µ—Ä–µ–¥—å. –í—Å–µ–≥–æ –≤ –æ—á–µ—Ä–µ–¥–∏: {_executionQueue.Count}");
```

**–ü–æ—Å–ª–µ**:
```csharp
// –õ–æ–≥ —É–¥–∞–ª—ë–Ω
```

### 2. NetworkSyncManager.cs ‚úÖ
**–£–±—Ä–∞–ª–∏ –ª–æ–≥–∏ –∏–∑ –≥–æ—Ä—è—á–∏—Ö –º–µ—Ç–æ–¥–æ–≤**:

#### Update() - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä (60 —Ä–∞–∑/—Å–µ–∫)
**–î–æ**:
```csharp
if (Time.frameCount % 60 == 0)
{
    Debug.Log($"[NetworkSync] üîß Update() —Ä–∞–±–æ—Ç–∞–µ—Ç. syncEnabled={syncEnabled}");
}
```

**–ü–æ—Å–ª–µ**:
```csharp
// –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ –ª–æ–≥–æ–≤
if (!syncEnabled)
    return;
```

#### OnPlayerMoved() - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è 10-20 —Ä–∞–∑/—Å–µ–∫
**–î–æ**:
```csharp
Debug.Log($"[NetworkSync] üîç RAW JSON for player_moved: {jsonData}");
Debug.Log($"[NetworkSync] üîç Deserialized: socketId='{data.socketId}'...");
Debug.Log($"[NetworkSync] ‚úÖ Updated position for {data.socketId}");
```

**–ü–æ—Å–ª–µ**:
```csharp
// –¢–æ–ª—å–∫–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑ –ª–æ–≥–æ–≤
player.UpdatePosition(pos, rot);
```

#### SyncLocalPlayerPosition() - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è 10 —Ä–∞–∑/—Å–µ–∫
**–î–æ**:
```csharp
if (Time.frameCount % 60 == 0)
{
    Debug.Log($"[NetworkSync] üîß SyncLocalPlayerPosition() –≤—ã–∑–≤–∞–Ω");
    Debug.Log($"[NetworkSync] üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–∏: pos=...");
}
```

**–ü–æ—Å–ª–µ**:
```csharp
// –¢–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –±–µ–∑ –ª–æ–≥–æ–≤
if (localPlayer == null || ...) return;
SocketIOManager.Instance.UpdatePosition(...);
```

#### SubscribeToNetworkEvents() - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è 1 —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
**–î–æ**:
```csharp
Debug.Log("[NetworkSync] üîß –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê: –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–¥–ø–∏—Å–∫—É...");
Debug.Log("[NetworkSync] üîß –ü–æ–¥–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ 'room_players'");
Debug.Log("[NetworkSync] üîß –ü–æ–¥–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ 'player_joined'");
// ... 10 –ª–æ–≥–æ–≤
```

**–ü–æ—Å–ª–µ**:
```csharp
// –í—Å–µ –ø–æ–¥–ø–∏—Å–∫–∏ –±–µ–∑ –ª–æ–≥–æ–≤
SocketIOManager.Instance.On("room_players", OnRoomPlayers);
SocketIOManager.Instance.On("player_joined", OnPlayerJoined);
// –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –∏—Ç–æ–≥–æ–≤—ã–π –ª–æ–≥:
Debug.Log("[NetworkSync] ‚úÖ –ü–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ —Å–µ—Ç–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è");
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- **–õ–æ–≥–æ–≤**: ~6000 –ª–æ–≥–æ–≤/–º–∏–Ω—É—Ç—É
- **–û—á–µ—Ä–µ–¥—å**: 226 –¥–µ–π—Å—Ç–≤–∏–π
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –¢–æ—Ä–º–æ–∑–∞, –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- **–õ–æ–≥–æ–≤**: ~100 –ª–æ–≥–æ–≤/–º–∏–Ω—É—Ç—É (—Ç–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è)
- **–û—á–µ—Ä–µ–¥—å**: 0-5 –¥–µ–π—Å—Ç–≤–∏–π (–Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞)
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ü–ª–∞–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞, –Ω–µ—Ç —Ç–æ—Ä–º–æ–∑–æ–≤

## –ö–∞–∫–∏–µ –ª–æ–≥–∏ –æ—Å—Ç–∞–ª–∏—Å—å?

–û—Å—Ç–∞–≤–∏–ª–∏ —Ç–æ–ª—å–∫–æ **–≤–∞–∂–Ω—ã–µ** –ª–æ–≥–∏:
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
- ‚úÖ –í—Ö–æ–¥/–≤—ã—Ö–æ–¥ –∏–≥—Ä–æ–∫–æ–≤ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã
- ‚úÖ –ê—Ç–∞–∫–∏ –∏ —É—Ä–æ–Ω
- ‚úÖ –°–º–µ—Ä—Ç–∏ –∏ —Ä–µ—Å–ø–∞–≤–Ω
- ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
- ‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—Ä–∞–≥–æ–≤ (CheckForPlayerComponents)

–£–±—Ä–∞–ª–∏ **–∏–∑–±—ã—Ç–æ—á–Ω—ã–µ** –ª–æ–≥–∏:
- ‚ùå –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ (10 —Ä–∞–∑/—Å–µ–∫)
- ‚ùå –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏
- ‚ùå –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å
- ‚ùå –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏
- ‚ùå –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–∏

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Unity ‚Üí Play
2. –í–æ–π–¥–∏—Ç–µ –≤ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä –∫–æ–º–Ω–∞—Ç—É
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Console (Ctrl+Shift+C)

**–î–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å**:
```
[NetworkSync] ‚úÖ –ü–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ —Å–µ—Ç–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è
[NetworkSync] üîÑ –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ –≤ –∫–æ–º–Ω–∞—Ç–µ...
[NetworkSync] –í –∫–æ–º–Ω–∞—Ç–µ 2 –∏–≥—Ä–æ–∫–æ–≤
```

**–ù–ï –¥–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å** (–±–æ–ª—å—à–µ –Ω–µ—Ç!):
```
[MainThreadDispatcher] üîß Action –¥–æ–±–∞–≤–ª–µ–Ω –≤ –æ—á–µ—Ä–µ–¥—å. –í—Å–µ–≥–æ –≤ –æ—á–µ—Ä–µ–¥–∏: 226
[NetworkSync] üîß Update() —Ä–∞–±–æ—Ç–∞–µ—Ç
[NetworkSync] üîç RAW JSON for player_moved: ...
[NetworkSync] üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–∏: ...
```

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

1. **Assets/Scripts/Network/UnityMainThreadDispatcher.cs**
   - –£–±—Ä–∞–ª–∏ –ª–æ–≥–∏ –∏–∑ `Enqueue()` (—Å—Ç—Ä–æ–∫–∞ 116)
   - –£–±—Ä–∞–ª–∏ –ª–æ–≥–∏ –∏–∑ `Update()` (—Å—Ç—Ä–æ–∫–∏ 79-83)

2. **Assets/Scripts/Network/NetworkSyncManager.cs**
   - –£–ø—Ä–æ—Å—Ç–∏–ª–∏ `Update()` (—Å—Ç—Ä–æ–∫–∏ 77-84)
   - –£–±—Ä–∞–ª–∏ –ª–æ–≥–∏ –∏–∑ `OnPlayerMoved()` (—Å—Ç—Ä–æ–∫–∏ 304-357)
   - –£–±—Ä–∞–ª–∏ –ª–æ–≥–∏ –∏–∑ `SyncLocalPlayerPosition()` (—Å—Ç—Ä–æ–∫–∏ 109-170)
   - –£–±—Ä–∞–ª–∏ –ª–æ–≥–∏ –∏–∑ `SubscribeToNetworkEvents()` (—Å—Ç—Ä–æ–∫–∏ 116-150)

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –†–∞—Å—á—ë—Ç –ª–æ–≥–æ–≤/—Å–µ–∫:

**–î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**:
```
Update(): 60 –∫–∞–¥—Ä–æ–≤/—Å–µ–∫ √ó 1 –ª–æ–≥/–∫–∞–¥—Ä = 60 –ª–æ–≥–æ–≤/—Å–µ–∫
OnPlayerMoved(): 10 —Å–æ–±—ã—Ç–∏–π/—Å–µ–∫ √ó 3 –ª–æ–≥–∞ √ó 2 –∏–≥—Ä–æ–∫–∞ = 60 –ª–æ–≥–æ–≤/—Å–µ–∫
SyncLocalPlayerPosition(): 10 —Ä–∞–∑/—Å–µ–∫ √ó 2 –ª–æ–≥–∞ = 20 –ª–æ–≥–æ–≤/—Å–µ–∫
Enqueue(): –∫–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ √ó 1 –ª–æ–≥ = 20 –ª–æ–≥–æ–≤/—Å–µ–∫
–ò–¢–û–ì–û: 160 –ª–æ–≥–æ–≤/—Å–µ–∫ = 9600 –ª–æ–≥–æ–≤/–º–∏–Ω—É—Ç—É
```

**–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**:
```
–¢–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è: ~2 –ª–æ–≥–∞/—Å–µ–∫ = 120 –ª–æ–≥–æ–≤/–º–∏–Ω—É—Ç—É
```

**–≠–∫–æ–Ω–æ–º–∏—è**: 98.75% –º–µ–Ω—å—à–µ –ª–æ–≥–æ–≤! üöÄ

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –±—É–¥—É—â–µ–µ

1. **–ù–ï –ª–æ–≥–∏—Ä—É–π—Ç–µ –≤ Update()** - —ç—Ç–æ 60 —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É!
2. **–ù–ï –ª–æ–≥–∏—Ä—É–π—Ç–µ –≤ OnPlayerMoved()** - —ç—Ç–æ 10-20 —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É!
3. **–ù–ï –ª–æ–≥–∏—Ä—É–π—Ç–µ –∫–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤ –æ—á–µ—Ä–µ–¥–∏** - —ç—Ç–æ —Å–æ—Ç–Ω–∏ —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É!
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É—Å–ª–æ–≤–∏–µ** `if (Time.frameCount % 300 == 0)` –¥–ª—è —Ä–µ–¥–∫–∏—Ö –ª–æ–≥–æ–≤ (—Ä–∞–∑ –≤ 5 —Å–µ–∫)
5. **–õ–æ–≥–∏—Ä—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏ –∏ –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è**

## –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –æ—Ç–ª–∞–¥–∫–∞

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏, –¥–æ–±–∞–≤—å—Ç–µ —Ñ–ª–∞–≥:

```csharp
[Header("Debug")]
[SerializeField] private bool verboseLogging = false; // –û—Ç–∫–ª—é—á–µ–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

void Update()
{
    if (verboseLogging && Time.frameCount % 60 == 0)
    {
        Debug.Log("[NetworkSync] üîß Update() —Ä–∞–±–æ—Ç–∞–µ—Ç");
    }
    // ...
}
```

–¢–æ–≥–¥–∞ –≤—ã —Å–º–æ–∂–µ—Ç–µ –≤–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏ —Ç–æ–ª—å–∫–æ –≤ Inspector –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –æ—Ç–ª–∞–¥–∫–∞, –Ω–µ –∑–∞—Å–æ—Ä—è—è Console –≤ –æ–±—ã—á–Ω–æ–π —Ä–∞–±–æ—Ç–µ.

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
**–î–∞—Ç–∞**: 2025-10-13
**–£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**: 98.75% –º–µ–Ω—å—à–µ –ª–æ–≥–æ–≤
