import sys
import time

# Wait a bit to ensure file is not locked
time.sleep(1)

file_path = r'c:/Users/Asus/Aetherion/Assets/Scripts/Player/HealthSystem.cs'

# Read the file
with open(file_path, 'r', encoding='utf-8') as f:
    content = f.read()

# Define the old and new strings
old_string = """    public void TakeDamage(float damage)
    {
        if (!IsAlive) return;

        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–Ω–∏–∂–µ–Ω–∏–µ —É—Ä–æ–Ω–∞
        float originalDamage = damage;"""

new_string = """    public void TakeDamage(float damage)
    {
        if (!IsAlive) return;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ—É—è–∑–≤–∏–º–æ—Å—Ç—å
        EffectManager effectManager = GetComponent<EffectManager>();
        if (effectManager != null && effectManager.HasInvulnerability())
        {
            Debug.Log($"[HealthSystem] üõ°Ô∏è –ù–ï–£–Ø–ó–í–ò–ú–û–°–¢–¨! –£—Ä–æ–Ω {damage:F0} –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω");
            return;
        }

        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–Ω–∏–∂–µ–Ω–∏–µ —É—Ä–æ–Ω–∞
        float originalDamage = damage;"""

# Check if the string exists
if old_string in content:
    # Replace
    content = content.replace(old_string, new_string)

    # Write back
    with open(file_path, 'w', encoding='utf-8') as f:
        f.write(content)

    print("‚úÖ Successfully added invulnerability check to TakeDamage method")
else:
    print("‚ùå Could not find the expected code pattern")
    print("File might have already been modified or has different formatting")
    sys.exit(1)
