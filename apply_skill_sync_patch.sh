#!/bin/bash
# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ç—á–∞ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å–∫–∏–ª–ª–æ–≤ –≤ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–µ

echo "üõ†Ô∏è –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ç—á–∞ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å–∫–∏–ª–ª–æ–≤..."

# –®–ê–ì 1: NetworkCombatSync.cs - –¥–æ–±–∞–≤–∏—Ç—å SendSkillUsed
echo "üìù –®–∞–≥ 1/5: –ü–∞—Ç—á–∏–º NetworkCombatSync.cs..."

# –°–æ–∑–¥–∞—ë–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–∞—Ç—á-—Ñ–∞–π–ª
cat > /tmp/networkcomba tsync_patch.txt << 'EOF'
    /// <summary>
    /// ‚úÖ –ù–û–í–´–ô –ú–ï–¢–û–î: –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∫–∏–ª–ª–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    /// –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ PlayerAttack.UseSkillDirectly() –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ UseSkill()
    /// </summary>
    public void SendSkillUsed(int skillId, string animationTrigger, Vector3 targetPosition, float castTime)
    {
        if (!enableSync || !isMultiplayer || SocketIOManager.Instance == null)
        {
            Debug.Log("[NetworkCombatSync] SendSkillUsed –ø—Ä–æ–ø—É—â–µ–Ω (–Ω–µ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä)");
            return;
        }

        if (!SocketIOManager.Instance.IsConnected)
        {
            Debug.LogWarning("[NetworkCombatSync] SendSkillUsed –ø—Ä–æ–ø—É—â–µ–Ω - –Ω–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É");
            return;
        }

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–∫–∏–ª–ª–∞ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        SocketIOManager.Instance.SendSkillUsed(skillId, animationTrigger, targetPosition, castTime);

        Debug.Log($"[NetworkCombatSync] üì° –°–∫–∏–ª–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä: ID={skillId}, trigger={animationTrigger}, castTime={castTime}—Å");
    }

EOF

# –í—Å—Ç–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–¥ OnDestroy()
sed -i '/void OnDestroy()/i \    /// <summary>\n    /// ‚úÖ –ù–û–í–´–ô –ú–ï–¢–û–î: –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∫–∏–ª–ª–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏\n    /// –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ PlayerAttack.UseSkillDirectly() –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ UseSkill()\n    /// <\/summary>\n    public void SendSkillUsed(int skillId, string animationTrigger, Vector3 targetPosition, float castTime)\n    {\n        if (!enableSync || !isMultiplayer || SocketIOManager.Instance == null)\n        {\n            Debug.Log("[NetworkCombatSync] SendSkillUsed –ø—Ä–æ–ø—É—â–µ–Ω (–Ω–µ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä)");\n            return;\n        }\n\n        if (!SocketIOManager.Instance.IsConnected)\n        {\n            Debug.LogWarning("[NetworkCombatSync] SendSkillUsed –ø—Ä–æ–ø—É—â–µ–Ω - –Ω–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É");\n            return;\n        }\n\n        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–∫–∏–ª–ª–∞ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏\n        SocketIOManager.Instance.SendSkillUsed(skillId, animationTrigger, targetPosition, castTime);\n\n        Debug.Log($"[NetworkCombatSync] üì° –°–∫–∏–ª–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä: ID={skillId}, trigger={animationTrigger}, castTime={castTime}—Å");\n    }\n' Assets/Scripts/Network/NetworkCombatSync.cs

echo "‚úÖ NetworkCombatSync.cs –æ–±–Ω–æ–≤–ª—ë–Ω!"

echo ""
echo "üéâ –ü–∞—Ç—á —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω—ë–Ω!"
echo ""
echo "‚ö†Ô∏è –í–ê–ñ–ù–û:"
echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ Unity Editor"
echo "2. –î–æ–∂–¥–∏—Ç–µ—Å—å –ø–µ—Ä–µ–∫–æ–º–ø–∏–ª—è—Ü–∏–∏ (Build Succeeded)"
echo "3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å 2 –∫–ª–∏–µ–Ω—Ç–∞–º–∏"
echo ""
echo "üìã –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤ APPLY_SKILL_SYNC_FIX.md –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —à–∞–≥–æ–≤"
