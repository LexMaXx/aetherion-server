#!/bin/bash
# –ü—Ä–∏–º–µ–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫ ArenaManager.cs

cd /c/Users/Asus/Aetherion

# –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —Å –Ω–æ–≤—ã–º –±–ª–æ–∫–æ–º –∫–æ–¥–∞
cat > new_block.txt << 'EOF'
        // –°–ò–°–¢–ï–ú–ê –°–ö–ò–õ–õ–û–í: EffectManager + SkillExecutor + SkillManager

        // 1. –î–æ–±–∞–≤–ª—è–µ–º EffectManager (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏: Root, Stun, Slow –∏ —Ç.–¥.)
        EffectManager effectManager = modelTransform.GetComponent<EffectManager>();
        if (effectManager == null)
        {
            effectManager = modelTransform.gameObject.AddComponent<EffectManager>();
            Debug.Log("‚úì –î–æ–±–∞–≤–ª–µ–Ω EffectManager");
        }

        // 2. –î–æ–±–∞–≤–ª—è–µ–º SkillExecutor (–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï! –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ü–ï–†–ï–î SkillManager)
        SkillExecutor skillExecutor = modelTransform.GetComponent<SkillExecutor>();
        if (skillExecutor == null)
        {
            skillExecutor = modelTransform.gameObject.AddComponent<SkillExecutor>();
            Debug.Log("‚úì –î–æ–±–∞–≤–ª–µ–Ω SkillExecutor");
        }

        // 3. –î–æ–±–∞–≤–ª—è–µ–º SkillManager (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–º —Å–∫–∏–ª–ª–æ–≤)
        SkillManager skillManager = modelTransform.GetComponent<SkillManager>();
        if (skillManager == null)
        {
            skillManager = modelTransform.gameObject.AddComponent<SkillManager>();
            Debug.Log("‚úì –î–æ–±–∞–≤–ª–µ–Ω SkillManager");
        }

        // 4. –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø –ó–ê–ì–†–£–ó–ö–ê –∏–∑ Resources/Skills/ –ø–æ –∫–ª–∞—Å—Å—É –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
        string selectedClass = PlayerPrefs.GetString("SelectedCharacterClass", "Warrior");
        Debug.Log($"[ArenaManager] üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–∫–∏–ª–ª–æ–≤ –¥–ª—è –∫–ª–∞—Å—Å–∞ {selectedClass} –∏–∑ Resources/Skills/...");
        LoadAllSkillsToManager(skillManager, selectedClass);
EOF

# –ü—Ä–∏–º–µ–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ awk
awk '
/–î–æ–±–∞–≤–ª—è–µ–º —Å–∏—Å—Ç–µ–º—É –æ—á–∫–æ–≤ –¥–µ–π—Å—Ç–≤–∏—è/,/LoadEquippedSkillsFromPlayerPrefs/ {
    if (/–î–æ–±–∞–≤–ª—è–µ–º —Å–∏—Å—Ç–µ–º—É –æ—á–∫–æ–≤ –¥–µ–π—Å—Ç–≤–∏—è/) {
        print
        getline; print
        getline; print
        getline; print
        getline; print
        getline; print
        getline
        print ""
        while ((getline line < "new_block.txt") > 0) {
            print line
        }
        close("new_block.txt")
        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Ç–∞—Ä—ã–µ —Å—Ç—Ä–æ–∫–∏ –¥–æ LoadEquippedSkillsFromPlayerPrefs –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ
        while (getline && !/LoadEquippedSkillsFromPlayerPrefs/) {}
        next
    }
}
{print}
' Assets/Scripts/Arena/ArenaManager.cs > Assets/Scripts/Arena/ArenaManager.cs.tmp

mv Assets/Scripts/Arena/ArenaManager.cs.tmp Assets/Scripts/Arena/ArenaManager.cs
rm new_block.txt

echo "‚úÖ –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!"
